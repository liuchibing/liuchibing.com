import{d as ne,r as $,u as _e,Y as K,E as oe,h as ae,a as U,m as D,b as G,c as P,e as p,o as h,f as V,g as y,i as n,w as u,j as b,p as ge,F as w,k as R,l as E,n as te,q as x,t as k,s as L,v as se,x as T,y as ue,z as ve,A as re,B as he,C as Q,D as Z,G as ie,H as be,I as Ee,J as de,K as ce,L as ye,M as Ve,N as we}from"./vendor-kMO5Jjgh.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const t of l)if(t.type==="childList")for(const a of t.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function f(l){const t={};return l.integrity&&(t.integrity=l.integrity),l.referrerPolicy&&(t.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?t.credentials="include":l.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function i(l){if(l.ep)return;l.ep=!0;const t=f(l);fetch(l.href,t)}})();const j=ne("config",()=>{const c=$({patterns:{},categories:{},ruleSets:{}}),{open:o,reset:f,onChange:i}=_e({accept:".yaml,.yml,text/vnd.yaml"});i(a=>{var m;a&&((m=a.item(0))==null||m.text().then(g=>{c.value=K.parse(g)}).catch(g=>{oe.alert(ae("pre",{style:{overflow:"scroll"}},`打开文件时遇到错误，请检查文件是否正确。
错误信息：
${g}`),"错误",{type:"error"})}).finally(()=>f()))});function l(){o()}function t(){const a=K.stringify(c.value),m=new File([a],"config.yaml"),g=URL.createObjectURL(m),d=document.createElement("a");d.href=g,d.download="config.yaml",d.click(),setTimeout(()=>{URL.revokeObjectURL(g),d.remove()},100)}return{config:c,load:l,save:t}});(()=>{const c=()=>{const i=new Error("not implemented");return i.code="ENOSYS",i};if(!globalThis.fs){let i="";globalThis.fs={constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1},writeSync(l,t){i+=f.decode(t);const a=i.lastIndexOf(`
`);return a!=-1&&(console.log(i.substring(0,a)),i=i.substring(a+1)),t.length},write(l,t,a,m,g,d){if(a!==0||m!==t.length||g!==null){d(c());return}const _=this.writeSync(l,t);d(null,_)},chmod(l,t,a){a(c())},chown(l,t,a,m){m(c())},close(l,t){t(c())},fchmod(l,t,a){a(c())},fchown(l,t,a,m){m(c())},fstat(l,t){t(c())},fsync(l,t){t(null)},ftruncate(l,t,a){a(c())},lchown(l,t,a,m){m(c())},link(l,t,a){a(c())},lstat(l,t){t(c())},mkdir(l,t,a){a(c())},open(l,t,a,m){m(c())},read(l,t,a,m,g,d){d(c())},readdir(l,t){t(c())},readlink(l,t){t(c())},rename(l,t,a){a(c())},rmdir(l,t){t(c())},stat(l,t){t(c())},symlink(l,t,a){a(c())},truncate(l,t,a){a(c())},unlink(l,t){t(c())},utimes(l,t,a,m){m(c())}}}if(globalThis.process||(globalThis.process={getuid(){return-1},getgid(){return-1},geteuid(){return-1},getegid(){return-1},getgroups(){throw c()},pid:-1,ppid:-1,umask(){throw c()},cwd(){throw c()},chdir(){throw c()}}),!globalThis.crypto)throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");if(!globalThis.performance)throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");if(!globalThis.TextEncoder)throw new Error("globalThis.TextEncoder is not available, polyfill required");if(!globalThis.TextDecoder)throw new Error("globalThis.TextDecoder is not available, polyfill required");const o=new TextEncoder("utf-8"),f=new TextDecoder("utf-8");globalThis.Go=class{constructor(){this.argv=["js"],this.env={},this.exit=e=>{e!==0&&console.warn("exit code:",e)},this._exitPromise=new Promise(e=>{this._resolveExitPromise=e}),this._pendingEvent=null,this._scheduledTimeouts=new Map,this._nextCallbackTimeoutID=1;const i=(e,s)=>{this.mem.setUint32(e+0,s,!0),this.mem.setUint32(e+4,Math.floor(s/4294967296),!0)},l=e=>{const s=this.mem.getUint32(e+0,!0),r=this.mem.getInt32(e+4,!0);return s+r*4294967296},t=e=>{const s=this.mem.getFloat64(e,!0);if(s===0)return;if(!isNaN(s))return s;const r=this.mem.getUint32(e,!0);return this._values[r]},a=(e,s)=>{if(typeof s=="number"&&s!==0){if(isNaN(s)){this.mem.setUint32(e+4,2146959360,!0),this.mem.setUint32(e,0,!0);return}this.mem.setFloat64(e,s,!0);return}if(s===void 0){this.mem.setFloat64(e,0,!0);return}let v=this._ids.get(s);v===void 0&&(v=this._idPool.pop(),v===void 0&&(v=this._values.length),this._values[v]=s,this._goRefCounts[v]=0,this._ids.set(s,v)),this._goRefCounts[v]++;let S=0;switch(typeof s){case"object":s!==null&&(S=1);break;case"string":S=2;break;case"symbol":S=3;break;case"function":S=4;break}this.mem.setUint32(e+4,2146959360|S,!0),this.mem.setUint32(e,v,!0)},m=e=>{const s=l(e+0),r=l(e+8);return new Uint8Array(this._inst.exports.mem.buffer,s,r)},g=e=>{const s=l(e+0),r=l(e+8),v=new Array(r);for(let S=0;S<r;S++)v[S]=t(s+S*8);return v},d=e=>{const s=l(e+0),r=l(e+8);return f.decode(new DataView(this._inst.exports.mem.buffer,s,r))},_=Date.now()-performance.now();this.importObject={_gotest:{add:(e,s)=>e+s},gojs:{"runtime.wasmExit":e=>{e>>>=0;const s=this.mem.getInt32(e+8,!0);this.exited=!0,delete this._inst,delete this._values,delete this._goRefCounts,delete this._ids,delete this._idPool,this.exit(s)},"runtime.wasmWrite":e=>{e>>>=0;const s=l(e+8),r=l(e+16),v=this.mem.getInt32(e+24,!0);fs.writeSync(s,new Uint8Array(this._inst.exports.mem.buffer,r,v))},"runtime.resetMemoryDataView":e=>{this.mem=new DataView(this._inst.exports.mem.buffer)},"runtime.nanotime1":e=>{e>>>=0,i(e+8,(_+performance.now())*1e6)},"runtime.walltime":e=>{e>>>=0;const s=new Date().getTime();i(e+8,s/1e3),this.mem.setInt32(e+16,s%1e3*1e6,!0)},"runtime.scheduleTimeoutEvent":e=>{e>>>=0;const s=this._nextCallbackTimeoutID;this._nextCallbackTimeoutID++,this._scheduledTimeouts.set(s,setTimeout(()=>{for(this._resume();this._scheduledTimeouts.has(s);)console.warn("scheduleTimeoutEvent: missed timeout event"),this._resume()},l(e+8))),this.mem.setInt32(e+16,s,!0)},"runtime.clearTimeoutEvent":e=>{e>>>=0;const s=this.mem.getInt32(e+8,!0);clearTimeout(this._scheduledTimeouts.get(s)),this._scheduledTimeouts.delete(s)},"runtime.getRandomData":e=>{e>>>=0,crypto.getRandomValues(m(e+8))},"syscall/js.finalizeRef":e=>{e>>>=0;const s=this.mem.getUint32(e+8,!0);if(this._goRefCounts[s]--,this._goRefCounts[s]===0){const r=this._values[s];this._values[s]=null,this._ids.delete(r),this._idPool.push(s)}},"syscall/js.stringVal":e=>{e>>>=0,a(e+24,d(e+8))},"syscall/js.valueGet":e=>{e>>>=0;const s=Reflect.get(t(e+8),d(e+16));e=this._inst.exports.getsp()>>>0,a(e+32,s)},"syscall/js.valueSet":e=>{e>>>=0,Reflect.set(t(e+8),d(e+16),t(e+32))},"syscall/js.valueDelete":e=>{e>>>=0,Reflect.deleteProperty(t(e+8),d(e+16))},"syscall/js.valueIndex":e=>{e>>>=0,a(e+24,Reflect.get(t(e+8),l(e+16)))},"syscall/js.valueSetIndex":e=>{e>>>=0,Reflect.set(t(e+8),l(e+16),t(e+24))},"syscall/js.valueCall":e=>{e>>>=0;try{const s=t(e+8),r=Reflect.get(s,d(e+16)),v=g(e+32),S=Reflect.apply(r,s,v);e=this._inst.exports.getsp()>>>0,a(e+56,S),this.mem.setUint8(e+64,1)}catch(s){e=this._inst.exports.getsp()>>>0,a(e+56,s),this.mem.setUint8(e+64,0)}},"syscall/js.valueInvoke":e=>{e>>>=0;try{const s=t(e+8),r=g(e+16),v=Reflect.apply(s,void 0,r);e=this._inst.exports.getsp()>>>0,a(e+40,v),this.mem.setUint8(e+48,1)}catch(s){e=this._inst.exports.getsp()>>>0,a(e+40,s),this.mem.setUint8(e+48,0)}},"syscall/js.valueNew":e=>{e>>>=0;try{const s=t(e+8),r=g(e+16),v=Reflect.construct(s,r);e=this._inst.exports.getsp()>>>0,a(e+40,v),this.mem.setUint8(e+48,1)}catch(s){e=this._inst.exports.getsp()>>>0,a(e+40,s),this.mem.setUint8(e+48,0)}},"syscall/js.valueLength":e=>{e>>>=0,i(e+16,parseInt(t(e+8).length))},"syscall/js.valuePrepareString":e=>{e>>>=0;const s=o.encode(String(t(e+8)));a(e+16,s),i(e+24,s.length)},"syscall/js.valueLoadString":e=>{e>>>=0;const s=t(e+8);m(e+16).set(s)},"syscall/js.valueInstanceOf":e=>{e>>>=0,this.mem.setUint8(e+24,t(e+8)instanceof t(e+16)?1:0)},"syscall/js.copyBytesToGo":e=>{e>>>=0;const s=m(e+8),r=t(e+32);if(!(r instanceof Uint8Array||r instanceof Uint8ClampedArray)){this.mem.setUint8(e+48,0);return}const v=r.subarray(0,s.length);s.set(v),i(e+40,v.length),this.mem.setUint8(e+48,1)},"syscall/js.copyBytesToJS":e=>{e>>>=0;const s=t(e+8),r=m(e+16);if(!(s instanceof Uint8Array||s instanceof Uint8ClampedArray)){this.mem.setUint8(e+48,0);return}const v=r.subarray(0,s.length);s.set(v),i(e+40,v.length),this.mem.setUint8(e+48,1)},debug:e=>{console.log(e)}}}}async run(i){if(!(i instanceof WebAssembly.Instance))throw new Error("Go.run: WebAssembly.Instance expected");this._inst=i,this.mem=new DataView(this._inst.exports.mem.buffer),this._values=[NaN,0,null,!0,!1,globalThis,this],this._goRefCounts=new Array(this._values.length).fill(1/0),this._ids=new Map([[0,1],[null,2],[!0,3],[!1,4],[globalThis,5],[this,6]]),this._idPool=[],this.exited=!1;let l=4096;const t=e=>{const s=l,r=o.encode(e+"\0");return new Uint8Array(this.mem.buffer,l,r.length).set(r),l+=r.length,l%8!==0&&(l+=8-l%8),s},a=this.argv.length,m=[];this.argv.forEach(e=>{m.push(t(e))}),m.push(0),Object.keys(this.env).sort().forEach(e=>{m.push(t(`${e}=${this.env[e]}`))}),m.push(0);const d=l;if(m.forEach(e=>{this.mem.setUint32(l,e,!0),this.mem.setUint32(l+4,0,!0),l+=8}),l>=12288)throw new Error("total length of command line and environment variables exceeds limit");this._inst.exports.run(a,d),this.exited&&this._resolveExitPromise(),await this._exitPromise}_resume(){if(this.exited)throw new Error("Go program has already exited");this._inst.exports.resume(),this.exited&&this._resolveExitPromise()}_makeFuncWrapper(i){const l=this;return function(){const t={id:i,this:this,args:arguments};return l._pendingEvent=t,l._resume(),t.result}}}})();async function Se(){if(typeof electronBridge<"u"){const c=await electronBridge.loadWasm();return new Response(c,{headers:{"Content-Type":"application/wasm"}})}else return await fetch("main.wasm")}const me=ne("appStatus",()=>{const c=j(),o=$("editing"),f=$(!1),i=$(""),l=$([]);function t(_){oe.alert(ae("pre",{style:{overflow:"scroll"}},`运行时遇到错误：
`+_),"错误",{type:"error"})}const a=new Go;WebAssembly.instantiateStreaming(Se(),a.importObject).then(_=>{a.run(_.instance),RhythmologistGo.registerErrorMessageCallback(t),f.value=!0});function m(){o.value="editing"}function g(){if(!f.value)return;l.value=[],o.value="running";const _=RhythmologistGo.generateBatchPreset(K.stringify(c.config),i.value);_!==null&&(l.value=K.parse(_),d())}function d(){o.value="result"}return{currentStep:o,goWasmReady:f,selectedPresetName:i,generationResult:l,edit:m,run:g,showResult:d}}),F=Symbol("keyForXObjArray");function pe(c){return c[F]||(c[F]=Symbol()),c[F]}const xe={style:{"margin-bottom":"8px"}},Ie={style:{"margin-bottom":"8px"}},Ce=U({__name:"ConfigChildItemList",props:D({defaultNewItemValue:{},dialogTitle:{default:""},dialogPrompt:{default:""},dialogErrorText:{default:""},disableScroll:{type:Boolean,default:!0},retrieveKey:{type:Function,default:(c,o)=>o}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const o=G(c,"modelValue"),f=c,i=$(!1),l=$(""),t=P(()=>!(l.value in o.value)&&l.value.length>0);function a(){Array.isArray(o.value)?o.value.push(f.defaultNewItemValue()):(o.value[l.value]=f.defaultNewItemValue(),l.value="",i.value=!1)}function m(){Array.isArray(o.value)?a():i.value=!0}function g(s){Array.isArray(o.value)?o.value.splice(s,1):delete o.value[s]}function d(s){if(Array.isArray(o.value)){const r=f.defaultNewItemValue();typeof o.value[s][F]<"u"&&(r[F]=o.value[s][F]),o.value[s]=r}else o.value[s]=f.defaultNewItemValue()}function _(s){if(Array.isArray(o.value)){let r=o.value.splice(s,1);o.value.splice(s-1,0,...r)}}function e(s){if(Array.isArray(o.value)){let r=o.value.splice(s,1);o.value.splice(s+1,0,...r)}}return(s,r)=>{const v=p("ElIcon"),S=p("ElButton"),z=p("ElForm"),B=p("ElCollapseItem"),q=p("ElCollapse"),I=p("ElScrollbar"),N=p("ElInput"),C=p("ElText"),H=p("el-button"),fe=p("ElDialog");return h(),V(w,null,[y("div",{class:he({"disable-scroll":f.disableScroll}),style:{display:"flex","flex-direction":"column"}},[y("div",xe,[n(S,{onClick:r[0]||(r[0]=O=>m())},{default:u(()=>[n(v,null,{default:u(()=>[n(b(ge))]),_:1})]),_:1})]),n(I,{style:{"padding-right":"10px"}},{default:u(()=>[n(q,null,{default:u(()=>[(h(!0),V(w,null,R(o.value,(O,A)=>(h(),E(B,{key:s.retrieveKey(O,A)},{title:u(()=>[te(s.$slots,"itemTitle",{item:O,key:A},()=>[x(k(A),1)],!0),Array.isArray(o.value)?(h(),V(w,{key:0},[A!==0?(h(),E(v,{key:0,class:"icon",onClick:L(J=>_(A),["stop"])},{default:u(()=>[n(b(se))]),_:2},1032,["onClick"])):T("",!0),A<o.value.length-1?(h(),E(v,{key:1,class:"icon",onClick:L(J=>e(A),["stop"])},{default:u(()=>[n(b(ue))]),_:2},1032,["onClick"])):T("",!0)],64)):T("",!0),n(v,{class:"icon",onClick:L(J=>d(A),["stop"])},{default:u(()=>[n(b(ve))]),_:2},1032,["onClick"]),n(v,{class:"icon",onClick:L(J=>g(A),["stop"])},{default:u(()=>[n(b(re))]),_:2},1032,["onClick"])]),default:u(()=>[n(z,{"label-position":"top"},{default:u(()=>[te(s.$slots,"default",{item:O,key:A},void 0,!0)]),_:2},1024)]),_:2},1024))),128))]),_:3})]),_:3})],2),n(fe,{modelValue:i.value,"onUpdate:modelValue":r[4]||(r[4]=O=>i.value=O),title:f.dialogTitle},{footer:u(()=>[y("span",null,[n(H,{onClick:r[2]||(r[2]=O=>i.value=!1)},{default:u(()=>[x("取消")]),_:1}),n(H,{type:"primary",disabled:!t.value,onClick:r[3]||(r[3]=O=>a())},{default:u(()=>[x(" 添加 ")]),_:1},8,["disabled"])])]),default:u(()=>[y("div",Ie,k(f.dialogPrompt),1),n(N,{modelValue:l.value,"onUpdate:modelValue":r[1]||(r[1]=O=>l.value=O)},null,8,["modelValue"]),Q(n(C,{type:"danger"},{default:u(()=>[x(k(f.dialogErrorText),1)]),_:1},512),[[Z,!t.value]])]),_:1},8,["modelValue","title"])],64)}}}),X=(c,o)=>{const f=c.__vccOpts||c;for(const[i,l]of o)f[i]=l;return f},M=X(Ce,[["__scopeId","data-v-613da4c1"]]),Ue=U({__name:"PatternsPane",setup(c){const o=j();return(f,i)=>{const l=p("ElInputNumber"),t=p("ElFormItem"),a=p("ElInput");return h(),E(M,{modelValue:b(o).config.patterns,"onUpdate:modelValue":i[0]||(i[0]=m=>b(o).config.patterns=m),"default-new-item-value":()=>({length:1}),"dialog-title":"添加节奏型","dialog-prompt":"请为节奏型设定一个唯一的标识名称，此名称会在其他地方用于指代此节奏型。","dialog-error-text":"名称不能为空或与现有节奏型重复。"},{default:u(({item:m})=>[n(t,{label:"长度length",required:""},{default:u(()=>[n(l,{modelValue:m.length,"onUpdate:modelValue":g=>m.length=g},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(t,{label:"显示名称displayName"},{default:u(()=>[n(a,{modelValue:m.displayName,"onUpdate:modelValue":g=>m.displayName=g},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(t,{label:"MusGlyphs显示内容displayMusGlyphs"},{default:u(()=>[n(a,{modelValue:m.displayMusGlyphs,"onUpdate:modelValue":g=>m.displayMusGlyphs=g,style:{"font-size":"1.25em"},class:"use-mus-glyphs"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1},8,["modelValue"])}}}),Pe=U({__name:"CategoriesPane",setup(c){const o=j();return(f,i)=>{const l=p("ElOption"),t=p("ElSelect"),a=p("ElFormItem");return h(),E(M,{modelValue:b(o).config.categories,"onUpdate:modelValue":i[0]||(i[0]=m=>b(o).config.categories=m),"default-new-item-value":()=>[],"dialog-title":"添加类别","dialog-prompt":"请为节奏型类别设定一个唯一的标识名称，此名称会在其他地方用于指代此类别。","dialog-error-text":"名称不能为空或与现有类别名重复。"},{default:u(({key:m})=>[n(a,{required:""},{default:u(()=>[n(t,{modelValue:b(o).config.categories[m],"onUpdate:modelValue":g=>b(o).config.categories[m]=g,multiple:"",filterable:""},{default:u(()=>[(h(!0),V(w,null,R(b(o).config.patterns,(g,d)=>(h(),E(l,{key:d,label:d,value:d},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1},8,["modelValue"])}}}),ke=U({__name:"FillEachBlankActionView",props:D({parentRuleSet:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const o=G(c,"modelValue"),f=c,i=P(()=>o.value.fillEachBlank);return(l,t)=>{const a=p("ElOption"),m=p("ElSelect"),g=p("ElFormItem"),d=p("ElInputNumber"),_=p("ElCard");return i.value?(h(),V(w,{key:0},[n(g,{label:"区域范围in",required:""},{default:u(()=>[n(m,{modelValue:i.value.in,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value.in=e),multiple:"",filterable:""},{default:u(()=>[(h(!0),V(w,null,R(f.parentRuleSet.layout,(e,s)=>(h(),E(a,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(g,{label:"步长stepLength"},{default:u(()=>[n(d,{modelValue:i.value.stepLength,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value.stepLength=e)},null,8,["modelValue"])]),_:1}),n(g,{label:"调用动作with",required:""},{default:u(()=>[n(_,{shadow:"never",style:{width:"100%"},class:"card-remove-last-margin-bottom"},{default:u(()=>[n(Y,{modelValue:i.value.with,"onUpdate:modelValue":t[2]||(t[2]=e=>i.value.with=e),mode:"action","parent-rule-set":l.parentRuleSet},null,8,["modelValue","parent-rule-set"])]),_:1})]),_:1})],64)):T("",!0)}}}),Re=U({__name:"ChooseARandomPositionActionView",props:D({parentRuleSet:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const o=G(c,"modelValue"),f=c,i=P(()=>o.value.chooseARandomPosition);return(l,t)=>{const a=p("ElOption"),m=p("ElSelect"),g=p("ElFormItem"),d=p("ElInputNumber"),_=p("ElCard");return i.value?(h(),V(w,{key:0},[n(g,{label:"区域范围in",required:""},{default:u(()=>[n(m,{modelValue:i.value.in,"onUpdate:modelValue":t[0]||(t[0]=e=>i.value.in=e),multiple:"",filterable:""},{default:u(()=>[(h(!0),V(w,null,R(f.parentRuleSet.layout,(e,s)=>(h(),E(a,{key:s,label:s,value:s},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(g,{label:"长度length",required:""},{default:u(()=>[n(d,{modelValue:i.value.length,"onUpdate:modelValue":t[1]||(t[1]=e=>i.value.length=e)},null,8,["modelValue"])]),_:1}),n(g,{label:"调用动作do",required:""},{default:u(()=>[n(_,{shadow:"never",style:{width:"100%"},class:"card-remove-last-margin-bottom"},{default:u(()=>[n(Y,{modelValue:i.value.do,"onUpdate:modelValue":t[2]||(t[2]=e=>i.value.do=e),mode:"action","parent-rule-set":l.parentRuleSet},null,8,["modelValue","parent-rule-set"])]),_:1})]),_:1})],64)):T("",!0)}}}),Te=U({__name:"RandomPickActionView",props:D({parentRuleSet:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const o=j(),f=G(c,"modelValue"),i=c,l=P(()=>f.value.randomPick);return(t,a)=>{const m=p("ElOption"),g=p("ElSelect"),d=p("ElButton"),_=p("ElFormItem"),e=p("ElInputNumber"),s=p("ElCard");return l.value?(h(),V(w,{key:0},[n(_,{label:"从分类中选取节奏型fromCategories"},{default:u(()=>[l.value.fromCategories?(h(),E(g,{key:0,modelValue:l.value.fromCategories,"onUpdate:modelValue":a[0]||(a[0]=r=>l.value.fromCategories=r),multiple:"",filterable:""},{default:u(()=>[(h(!0),V(w,null,R(b(o).config.categories,(r,v)=>(h(),E(m,{key:v,label:v,value:v},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(h(),E(d,{key:1,onClick:a[1]||(a[1]=r=>l.value.fromCategories=[])},{default:u(()=>[x("创建")]),_:1}))]),_:1}),n(_,{label:"从此列表中选取节奏型fromList"},{default:u(()=>[l.value.fromList?(h(),E(g,{key:0,modelValue:l.value.fromList,"onUpdate:modelValue":a[2]||(a[2]=r=>l.value.fromList=r),multiple:"",filterable:""},{default:u(()=>[(h(!0),V(w,null,R(b(o).config.patterns,(r,v)=>(h(),E(m,{key:v,label:v,value:v},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(h(),E(d,{key:1,onClick:a[3]||(a[3]=r=>l.value.fromList=[])},{default:u(()=>[x("创建")]),_:1}))]),_:1}),n(_,{label:"长度length"},{default:u(()=>[n(e,{modelValue:l.value.length,"onUpdate:modelValue":a[4]||(a[4]=r=>l.value.length=r)},null,8,["modelValue"])]),_:1}),n(_,{label:"在此布局区域开头放置in"},{default:u(()=>[n(g,{modelValue:l.value.in,"onUpdate:modelValue":a[5]||(a[5]=r=>l.value.in=r),filterable:""},{default:u(()=>[(h(!0),V(w,null,R(i.parentRuleSet.layout,(r,v)=>(h(),E(m,{key:v,label:v,value:v},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(_,{label:"在指定节拍位置放置(0起计数)at"},{default:u(()=>[n(e,{modelValue:l.value.at,"onUpdate:modelValue":a[6]||(a[6]=r=>l.value.at=r)},null,8,["modelValue"])]),_:1}),n(_,{label:"约束constraints"},{default:u(()=>[l.value.constraints?(h(),E(s,{key:0,shadow:"never",style:{width:"100%"}},{default:u(()=>[n(M,{modelValue:l.value.constraints,"onUpdate:modelValue":a[7]||(a[7]=r=>l.value.constraints=r),"default-new-item-value":()=>({}),"disable-scroll":!1,"retrieve-key":b(pe)},{itemTitle:u(({item:r,key:v})=>[x(k(v)+" : "+k(Object.keys(r)[0]),1)]),default:u(({key:r})=>[n(Y,{modelValue:l.value.constraints[r],"onUpdate:modelValue":v=>l.value.constraints[r]=v,mode:"constraint","parent-rule-set":i.parentRuleSet},null,8,["modelValue","onUpdate:modelValue","parent-rule-set"])]),_:1},8,["modelValue","retrieve-key"])]),_:1})):(h(),E(d,{key:1,onClick:a[8]||(a[8]=r=>l.value.constraints=[])},{default:u(()=>[x("创建")]),_:1}))]),_:1})],64)):T("",!0)}}}),Ne=U({__name:"UsageCountGroupConstraintView",props:D({parentRuleSet:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const o=G(c,"modelValue"),f=P(()=>o.value.usageCountGroup);return(i,l)=>{const t=p("ElInput"),a=p("ElFormItem");return f.value?(h(),E(a,{key:0,label:"名称name",required:""},{default:u(()=>[n(t,{modelValue:f.value.name,"onUpdate:modelValue":l[0]||(l[0]=m=>f.value.name=m)},null,8,["modelValue"])]),_:1})):T("",!0)}}}),Oe={style:{"margin-top":"4px",display:"flex","align-items":"center"}},Ae=U({__name:"RejectPatternWithUsageCountConstraintView",props:D({parentRuleSet:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const o=G(c,"modelValue"),f=P(()=>o.value.rejectPatternWithUsageCount),i=P(()=>{var l,t,a;return((l=f.value)==null?void 0:l.value)==="max"||((t=f.value)==null?void 0:t.value)==="maxAutoBalance"||typeof((a=f.value)==null?void 0:a.value)=="number"});return(l,t)=>{const a=p("ElRadio"),m=p("ElRadioGroup"),g=p("ElFormItem"),d=p("ElInput"),_=p("ElOption"),e=p("ElSelect"),s=p("ElText"),r=p("ElButton");return f.value?(h(),V(w,{key:0},[n(g,{label:"层级level",required:""},{default:u(()=>[n(m,{modelValue:f.value.level,"onUpdate:modelValue":t[0]||(t[0]=v=>f.value.level=v)},{default:u(()=>[n(a,{label:"batch"},{default:u(()=>[x("批次batch")]),_:1}),n(a,{label:"piece"},{default:u(()=>[x("条目piece")]),_:1})]),_:1},8,["modelValue"])]),_:1}),n(g,{label:"计数组名称groupName",required:""},{default:u(()=>[n(d,{modelValue:f.value.groupName,"onUpdate:modelValue":t[1]||(t[1]=v=>f.value.groupName=v)},null,8,["modelValue"])]),_:1}),n(g,{label:"比较运算符comparator",required:""},{default:u(()=>[n(e,{modelValue:f.value.comparator,"onUpdate:modelValue":t[2]||(t[2]=v=>f.value.comparator=v)},{default:u(()=>[(h(),V(w,null,R(["<","<=","==",">=",">","!="],v=>n(_,{key:v,label:v,value:v},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),n(g,{label:"比较值value",required:""},{default:u(()=>[n(d,{modelValue:f.value.value,"onUpdate:modelValue":t[3]||(t[3]=v=>f.value.value=v),modelModifiers:{number:!0}},null,8,["modelValue"]),y("div",Oe,[n(s,{size:"small"},{default:u(()=>[x("特殊值：")]),_:1}),n(r,{size:"small",onClick:t[4]||(t[4]=v=>f.value.value="max")},{default:u(()=>[x("max")]),_:1}),n(r,{size:"small",onClick:t[5]||(t[5]=v=>f.value.value="maxAutoBalance")},{default:u(()=>[x("maxAutoBalance")]),_:1})]),Q(n(s,{type:"danger"},{default:u(()=>[x("value值无效，应为数字或“max”，“maxAutoBalance”")]),_:1},512),[[Z,!i.value]])]),_:1})],64)):T("",!0)}}}),Y=U({__name:"XObjEditor",props:D({mode:{},parentRuleSet:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(c){const o=G(c,"modelValue"),f=c,i=P(()=>{if(f.mode==="action")return{fillEachBlank:{defaults:()=>({in:[],with:{}}),view:ke},chooseARandomPosition:{defaults:()=>({in:[],length:1,do:{}}),view:Re},randomPick:{defaults:()=>({}),view:Te}};if(f.mode==="constraint")return{usageCountGroup:{defaults:()=>({name:""}),view:Ne},rejectPatternWithUsageCount:{defaults:()=>({level:"piece",groupName:"",comparator:">=",value:"maxAutoBalance"}),view:Ae}};throw TypeError()});function l(a){return a in i.value}const t=P({get:()=>{const a=Object.keys(o.value);if(a.length===0)return"";if(l(a[0]))return a[0];throw TypeError()},set:a=>{if(a==="")o.value={[F]:o.value[F]};else if(l(a))o.value={[a]:i.value[a].defaults(),[F]:o.value[F]};else return}});return(a,m)=>{var e;const g=p("ElOption"),d=p("ElSelect"),_=p("ElFormItem");return h(),V(w,null,[n(_,{label:"动作类型",required:""},{default:u(()=>[n(d,{modelValue:t.value,"onUpdate:modelValue":m[0]||(m[0]=s=>t.value=s),filterable:""},{default:u(()=>[(h(!0),V(w,null,R(i.value,(s,r)=>(h(),E(g,{key:r,value:r},null,8,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(h(),E(ie(t.value===""?null:(e=i.value[t.value])==null?void 0:e.view),{modelValue:o.value,"onUpdate:modelValue":m[1]||(m[1]=s=>o.value=s),"parent-rule-set":a.parentRuleSet},null,8,["modelValue","parent-rule-set"]))],64)}}}),$e=U({__name:"RuleSetsPane",setup(c){const o=j();return(f,i)=>{const l=p("ElInput"),t=p("ElFormItem"),a=p("ElInputNumber"),m=p("ElCard");return h(),E(M,{modelValue:b(o).config.ruleSets,"onUpdate:modelValue":i[0]||(i[0]=g=>b(o).config.ruleSets=g),"default-new-item-value":()=>({timeSignature:"4/4",bpm:72,pieceLength:8,layout:{},actions:[]}),"dialog-title":"添加规则集","dialog-prompt":"请为规则集设定一个唯一的标识名称，此名称会在其他地方用于指代此规则集。","dialog-error-text":"名称不能为空或与现有规则集重复。"},{default:u(({item:g,key:d})=>[n(t,{label:"拍号timeSignature",required:""},{default:u(()=>[n(l,{modelValue:g.timeSignature,"onUpdate:modelValue":_=>g.timeSignature=_},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(t,{label:"速度bpm",required:""},{default:u(()=>[n(a,{modelValue:g.bpm,"onUpdate:modelValue":_=>g.bpm=_},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(t,{label:"每条长度pieceLength",required:""},{default:u(()=>[n(a,{modelValue:g.pieceLength,"onUpdate:modelValue":_=>g.pieceLength=_},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(t,{label:"布局layout",required:""},{default:u(()=>[n(m,{shadow:"never",style:{width:"100%"}},{default:u(()=>[n(M,{modelValue:b(o).config.ruleSets[d].layout,"onUpdate:modelValue":_=>b(o).config.ruleSets[d].layout=_,"default-new-item-value":()=>({start:0,end:g.pieceLength}),"dialog-title":"添加布局区域","dialog-prompt":"请为布局区域设定一个唯一的标识名称，此名称会在其他地方用于指代此布局区域。","dialog-error-text":"名称不能为空或与现有布局区域重复。","disable-scroll":!1},{default:u(({item:_})=>[n(t,{label:"起点(含)start",required:""},{default:u(()=>[n(a,{modelValue:_.start,"onUpdate:modelValue":e=>_.start=e},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(t,{label:"终点(不含)end",required:""},{default:u(()=>[n(a,{modelValue:_.end,"onUpdate:modelValue":e=>_.end=e},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","default-new-item-value"])]),_:2},1024)]),_:2},1024),n(t,{label:"动作actions",required:""},{default:u(()=>[n(m,{shadow:"never",style:{width:"100%"}},{default:u(()=>[n(M,{modelValue:b(o).config.ruleSets[d].actions,"onUpdate:modelValue":_=>b(o).config.ruleSets[d].actions=_,"default-new-item-value":()=>({}),"disable-scroll":!1,"retrieve-key":b(pe)},{itemTitle:u(({item:_,key:e})=>[x(k(e)+" : "+k(Object.keys(_)[0]),1)]),default:u(({key:_})=>[n(Y,{modelValue:b(o).config.ruleSets[d].actions[_],"onUpdate:modelValue":e=>b(o).config.ruleSets[d].actions[_]=e,mode:"action","parent-rule-set":b(o).config.ruleSets[d]},null,8,["modelValue","onUpdate:modelValue","parent-rule-set"])]),_:2},1032,["modelValue","onUpdate:modelValue","retrieve-key"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"])}}}),Fe={style:{display:"flex","justify-content":"flex-end"}},je=U({__name:"BatchPresetsPane",setup(c){const o=j(),f=P(()=>{if(!o.config.batchPresets)return{};let d={};for(const _ in o.config.batchPresets)if(Object.prototype.hasOwnProperty.call(o.config.batchPresets,_)){const e=o.config.batchPresets[_];d[_]=e.map(s=>{let r=Object.keys(s);return r.length<=0?{ruleSetName:"",amount:0}:{ruleSetName:r[0],amount:s[r[0]]}})}return d}),i=$(""),l=$(1);function t(d){o.config.batchPresets&&o.config.batchPresets[d].push({[i.value]:l.value})}function a(d,_){o.config.batchPresets&&o.config.batchPresets[d].splice(_,1)}function m(d,_){if(o.config.batchPresets){let e=o.config.batchPresets[d].splice(_,1);o.config.batchPresets[d].splice(_-1,0,...e)}}function g(d,_){if(o.config.batchPresets){let e=o.config.batchPresets[d].splice(_,1);o.config.batchPresets[d].splice(_+1,0,...e)}}return(d,_)=>{const e=p("ElOption"),s=p("ElSelect"),r=p("ElFormItem"),v=p("ElInputNumber"),S=p("ElButton"),z=p("ElForm"),B=p("ElTableColumn"),q=p("ElIcon"),I=p("ElTable");return b(o).config.batchPresets?(h(),E(M,{key:0,modelValue:b(o).config.batchPresets,"onUpdate:modelValue":_[2]||(_[2]=N=>b(o).config.batchPresets=N),"default-new-item-value":()=>[],"dialog-title":"添加节奏型","dialog-prompt":"请为节奏型设定一个唯一的标识名称，此名称会在其他地方用于指代此节奏型。","dialog-error-text":"名称不能为空或与现有节奏型重复。"},{default:u(({key:N})=>[n(z,{inline:"",style:{display:"flex"}},{default:u(()=>[n(r,{style:{width:"calc((100% - 110px) * 0.5)"}},{default:u(()=>[n(s,{modelValue:i.value,"onUpdate:modelValue":_[0]||(_[0]=C=>i.value=C),placeholder:"规则集名称ruleSetName",filterable:""},{default:u(()=>[(h(!0),V(w,null,R(Object.keys(b(o).config.ruleSets),C=>(h(),E(e,{key:C,label:C,value:C},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),n(r,null,{default:u(()=>[n(v,{modelValue:l.value,"onUpdate:modelValue":_[1]||(_[1]=C=>l.value=C),placeholder:"数量amount"},null,8,["modelValue"])]),_:1}),n(r,null,{default:u(()=>[n(S,{onClick:C=>t(N)},{default:u(()=>[x("添加")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),n(I,{data:f.value[N]},{default:u(()=>[n(B,{prop:"ruleSetName",label:"规则集名称ruleSetName"}),n(B,{prop:"amount",label:"数量amount"}),n(B,{label:"操作",width:"110px"},{default:u(C=>[y("div",Fe,[C.$index!==0?(h(),E(S,{key:0,link:"",class:"icon",onClick:L(H=>m(N,C.$index),["stop"])},{default:u(()=>[n(q,null,{default:u(()=>[n(b(se))]),_:1})]),_:2},1032,["onClick"])):T("",!0),C.$index<f.value[N].length-1?(h(),E(S,{key:1,link:"",class:"icon",onClick:L(H=>g(N,C.$index),["stop"])},{default:u(()=>[n(q,null,{default:u(()=>[n(b(ue))]),_:1})]),_:2},1032,["onClick"])):T("",!0),n(S,{link:"",onClick:L(H=>a(N,C.$index),["prevent"])},{default:u(()=>[n(q,null,{default:u(()=>[n(b(re))]),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["data"])]),_:1},8,["modelValue"])):(h(),E(S,{key:1,onClick:_[3]||(_[3]=N=>b(o).config.batchPresets={})},{default:u(()=>[x(" 创建 ")]),_:1}))}}}),Be=X(je,[["__scopeId","data-v-6c8c9e22"]]),qe=U({__name:"SettingsPane",setup(c){const o=j();return o.config.settings||(o.config.settings={autoSeed:!0}),be(()=>{var f;return(f=o.config.settings)==null?void 0:f.autoSeed},f=>{f&&delete o.config.settings.fixedSeed}),(f,i)=>{const l=p("ElSwitch"),t=p("ElFormItem"),a=p("ElInput"),m=p("ElForm");return h(),E(m,{"label-position":"top"},{default:u(()=>[n(t,{label:"自动设置随机数种子autoSeed"},{default:u(()=>[n(l,{modelValue:b(o).config.settings.autoSeed,"onUpdate:modelValue":i[0]||(i[0]=g=>b(o).config.settings.autoSeed=g)},null,8,["modelValue"])]),_:1}),Q(n(t,{label:"固定种子数值fixedSeed"},{default:u(()=>[n(a,{modelValue:b(o).config.settings.fixedSeed,"onUpdate:modelValue":i[1]||(i[1]=g=>b(o).config.settings.fixedSeed=g),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1},512),[[Z,!b(o).config.settings.autoSeed]])]),_:1})}}}),le=U({__name:"EditorPage",setup(c){const o=j();return(f,i)=>{const l=p("ElTabPane"),t=p("ElTabs"),a=p("ElCol"),m=p("ElScrollbar"),g=p("ElRow");return h(),E(g,{class:"disable-scroll"},{default:u(()=>[n(a,{span:16,class:"disable-scroll"},{default:u(()=>[n(t,{"tab-position":"left",class:"disable-scroll"},{default:u(()=>[n(l,{label:"节奏型列表patterns",class:"disable-scroll"},{default:u(()=>[n(Ue)]),_:1}),n(l,{label:"节奏型分类categories",class:"disable-scroll"},{default:u(()=>[n(Pe)]),_:1}),n(l,{label:"规则集ruleSets",class:"disable-scroll"},{default:u(()=>[n($e)]),_:1}),n(l,{label:"批量生成预设batchPresets",class:"disable-scroll"},{default:u(()=>[n(Be)]),_:1}),n(l,{label:"生成器设置settings",class:"disable-scroll"},{default:u(()=>[n(qe)]),_:1})]),_:1})]),_:1}),n(a,{span:8,class:"disable-scroll"},{default:u(()=>[n(m,null,{default:u(()=>[y("code",null,[y("pre",null,k(b(K).stringify(b(o).config)),1)])]),_:1})]),_:1})]),_:1})}}}),Le=c=>(de("data-v-04f42d4a"),c=c(),ce(),c),Me={style:{"margin-right":"8px"}},De={class:"piece-score"},Ge=Le(()=>y("span",null,k("K"),-1)),We=U({__name:"ResultPage",setup(c){const o=me();function f(i){const l=i.split("/");return{upper:Number.parseInt(l[0]),lower:Number.parseInt(l[1])}}return(i,l)=>{const t=p("ElScrollbar");return h(),E(t,null,{default:u(()=>[(h(!0),V(w,null,R(b(o).generationResult,(a,m)=>(h(),V("div",{key:m,class:"piece-box"},[y("div",Me,"("+k(m+1)+")",1),y("div",De,[y("span",null,k(a.timeSignature+"  "),1),(h(!0),V(w,null,R(a.beats,(g,d)=>(h(),V(w,{key:d},[y("span",null,k(d%f(a.timeSignature).upper==0&&d>0?"  |  ":""),1),g.offset===0?(h(),V("span",{key:0,class:"beat",style:Ee({minWidth:g.pattern.length*50+"px"})},k(g.pattern.displayMusGlyphs),5)):T("",!0)],64))),128)),Ge])]))),128))]),_:1})}}}),ze=X(We,[["__scopeId","data-v-04f42d4a"]]),W=c=>(de("data-v-ded536bd"),c=c(),ce(),c),He={style:{"margin-left":"50px","margin-right":"50px",flex:"1"}},Ke={style:{"margin-left":"auto"}},Xe=W(()=>y("h1",null,"Rhythmologist",-1)),Ye=W(()=>y("p",null,"Copyright © 2024 Liu Chibing. All rights reserved.",-1)),Je=W(()=>y("h2",null,"鸣谢",-1)),Qe=W(()=>y("p",null,"王晔 教授",-1)),Ze=W(()=>y("h3",null,"开源代码",-1)),et=W(()=>y("ul",null,[y("li",null,"Vue"),y("li",null,"Element Plus"),y("li",null,"TypeScript"),y("li",null,"Go"),y("li",null,"Electron")],-1)),tt=U({__name:"App",setup(c){const o=me(),f=j(),i=P(()=>{switch(o.currentStep){case"editing":return 1;case"running":case"result":return 2;default:return 0}}),l=P(()=>{switch(o.currentStep){case"editing":return"process";case"running":case"result":return"success";default:return"wait"}}),t=P(()=>{switch(o.currentStep){case"editing":return"wait";case"running":return"process";case"result":return"success";default:return"wait"}}),a=P(()=>{switch(o.currentStep){case"editing":return le;case"running":case"result":return ze;default:return le}}),m=$(!1);return(g,d)=>{const _=p("ElStep"),e=p("ElSteps"),s=p("ElOption"),r=p("ElSelect"),v=p("ElButton"),S=p("ElHeader"),z=p("ElMain"),B=p("ElContainer"),q=p("ElDialog");return h(),V(w,null,[n(B,{class:"disable-scroll"},{default:u(()=>[n(S,null,{default:u(()=>[y("h1",{onClick:d[0]||(d[0]=I=>m.value=!0)},"Rhythmologist"),y("div",He,[n(e,{simple:"",active:i.value},{default:u(()=>[n(_,{title:"配置编辑",status:l.value},null,8,["status"]),n(_,{title:"运行结果",status:t.value},null,8,["status"])]),_:1},8,["active"])]),y("div",Ke,[b(f).config.batchPresets?(h(),E(r,{key:0,modelValue:b(o).selectedPresetName,"onUpdate:modelValue":d[1]||(d[1]=I=>b(o).selectedPresetName=I),placeholder:"选择生成预设",style:{width:"150px","margin-right":"12px"}},{default:u(()=>[(h(!0),V(w,null,R(Object.keys(b(f).config.batchPresets),I=>(h(),E(s,{key:I,label:I,value:I},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):T("",!0),n(v,{disabled:!b(f).config.batchPresets||!(b(o).selectedPresetName in b(f).config.batchPresets)||!b(o).goWasmReady,onClick:d[2]||(d[2]=I=>b(o).run())},{default:u(()=>[x(" 运行 ")]),_:1},8,["disabled"]),T("",!0),b(o).currentStep==="editing"?(h(),V(w,{key:2},[n(v,{onClick:d[3]||(d[3]=I=>b(f).load())},{default:u(()=>[x("打开")]),_:1}),n(v,{onClick:d[4]||(d[4]=I=>b(f).save())},{default:u(()=>[x("保存")]),_:1})],64)):(h(),E(v,{key:3,onClick:d[5]||(d[5]=I=>b(o).edit())},{default:u(()=>[x("返回编辑")]),_:1}))])]),_:1}),n(z,{class:"disable-scroll"},{default:u(()=>[(h(),E(ie(a.value)))]),_:1})]),_:1}),n(q,{modelValue:m.value,"onUpdate:modelValue":d[6]||(d[6]=I=>m.value=I),title:"关于",class:"about-dialog"},{default:u(()=>[Xe,Ye,Je,Qe,Ze,et]),_:1},8,["modelValue"])],64)}}}),lt=X(tt,[["__scopeId","data-v-ded536bd"]]),ee=ye(lt);ee.use(Ve());ee.use(we);ee.mount("#app");
