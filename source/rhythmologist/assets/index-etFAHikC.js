import{d as ne,r as T,u as pe,Y as K,E as oe,h as ae,a as U,m as M,b as G,c as P,e as m,o as h,f as S,g as y,i as o,w as u,j as b,p as fe,F as C,k as A,l as E,n as te,q as w,t as j,s as q,v as se,x as k,y as ue,z as _e,A as re,B as ge,C as Q,D as Z,G as ie,H as ve,I as he,J as be,K as Ee,L as Ve,M as ye,N as we,O as Se,P as Ce}from"./vendor-Xbs8zkgr.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const s of l.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function c(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?l.credentials="include":t.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function r(t){if(t.ep)return;t.ep=!0;const l=c(t);fetch(t.href,l)}})();const F=ne("config",()=>{const d=T({patterns:{},categories:{},ruleSets:{}}),{open:n,reset:c,onChange:r}=pe({accept:".yaml,.yml,text/vnd.yaml"});r(s=>{var p;s&&((p=s.item(0))==null||p.text().then(v=>{d.value=K.parse(v)}).catch(v=>{oe.alert(ae("pre",{style:{overflow:"scroll"}},`打开文件时遇到错误，请检查文件是否正确。
错误信息：
${v}`),"错误",{type:"error"})}).finally(()=>c()))});function t(){n()}function l(){const s=K.stringify(d.value),p=new File([s],"config.yaml"),v=URL.createObjectURL(p),f=document.createElement("a");f.href=v,f.download="config.yaml",f.click(),setTimeout(()=>{URL.revokeObjectURL(v),f.remove()},100)}return{config:d,load:t,save:l}});(()=>{const d=()=>{const r=new Error("not implemented");return r.code="ENOSYS",r};if(!globalThis.fs){let r="";globalThis.fs={constants:{O_WRONLY:-1,O_RDWR:-1,O_CREAT:-1,O_TRUNC:-1,O_APPEND:-1,O_EXCL:-1},writeSync(t,l){r+=c.decode(l);const s=r.lastIndexOf(`
`);return s!=-1&&(console.log(r.substring(0,s)),r=r.substring(s+1)),l.length},write(t,l,s,p,v,f){if(s!==0||p!==l.length||v!==null){f(d());return}const _=this.writeSync(t,l);f(null,_)},chmod(t,l,s){s(d())},chown(t,l,s,p){p(d())},close(t,l){l(d())},fchmod(t,l,s){s(d())},fchown(t,l,s,p){p(d())},fstat(t,l){l(d())},fsync(t,l){l(null)},ftruncate(t,l,s){s(d())},lchown(t,l,s,p){p(d())},link(t,l,s){s(d())},lstat(t,l){l(d())},mkdir(t,l,s){s(d())},open(t,l,s,p){p(d())},read(t,l,s,p,v,f){f(d())},readdir(t,l){l(d())},readlink(t,l){l(d())},rename(t,l,s){s(d())},rmdir(t,l){l(d())},stat(t,l){l(d())},symlink(t,l,s){s(d())},truncate(t,l,s){s(d())},unlink(t,l){l(d())},utimes(t,l,s,p){p(d())}}}if(globalThis.process||(globalThis.process={getuid(){return-1},getgid(){return-1},geteuid(){return-1},getegid(){return-1},getgroups(){throw d()},pid:-1,ppid:-1,umask(){throw d()},cwd(){throw d()},chdir(){throw d()}}),!globalThis.crypto)throw new Error("globalThis.crypto is not available, polyfill required (crypto.getRandomValues only)");if(!globalThis.performance)throw new Error("globalThis.performance is not available, polyfill required (performance.now only)");if(!globalThis.TextEncoder)throw new Error("globalThis.TextEncoder is not available, polyfill required");if(!globalThis.TextDecoder)throw new Error("globalThis.TextDecoder is not available, polyfill required");const n=new TextEncoder("utf-8"),c=new TextDecoder("utf-8");globalThis.Go=class{constructor(){this.argv=["js"],this.env={},this.exit=e=>{e!==0&&console.warn("exit code:",e)},this._exitPromise=new Promise(e=>{this._resolveExitPromise=e}),this._pendingEvent=null,this._scheduledTimeouts=new Map,this._nextCallbackTimeoutID=1;const r=(e,a)=>{this.mem.setUint32(e+0,a,!0),this.mem.setUint32(e+4,Math.floor(a/4294967296),!0)},t=e=>{const a=this.mem.getUint32(e+0,!0),i=this.mem.getInt32(e+4,!0);return a+i*4294967296},l=e=>{const a=this.mem.getFloat64(e,!0);if(a===0)return;if(!isNaN(a))return a;const i=this.mem.getUint32(e,!0);return this._values[i]},s=(e,a)=>{if(typeof a=="number"&&a!==0){if(isNaN(a)){this.mem.setUint32(e+4,2146959360,!0),this.mem.setUint32(e,0,!0);return}this.mem.setFloat64(e,a,!0);return}if(a===void 0){this.mem.setFloat64(e,0,!0);return}let g=this._ids.get(a);g===void 0&&(g=this._idPool.pop(),g===void 0&&(g=this._values.length),this._values[g]=a,this._goRefCounts[g]=0,this._ids.set(a,g)),this._goRefCounts[g]++;let V=0;switch(typeof a){case"object":a!==null&&(V=1);break;case"string":V=2;break;case"symbol":V=3;break;case"function":V=4;break}this.mem.setUint32(e+4,2146959360|V,!0),this.mem.setUint32(e,g,!0)},p=e=>{const a=t(e+0),i=t(e+8);return new Uint8Array(this._inst.exports.mem.buffer,a,i)},v=e=>{const a=t(e+0),i=t(e+8),g=new Array(i);for(let V=0;V<i;V++)g[V]=l(a+V*8);return g},f=e=>{const a=t(e+0),i=t(e+8);return c.decode(new DataView(this._inst.exports.mem.buffer,a,i))},_=Date.now()-performance.now();this.importObject={_gotest:{add:(e,a)=>e+a},gojs:{"runtime.wasmExit":e=>{e>>>=0;const a=this.mem.getInt32(e+8,!0);this.exited=!0,delete this._inst,delete this._values,delete this._goRefCounts,delete this._ids,delete this._idPool,this.exit(a)},"runtime.wasmWrite":e=>{e>>>=0;const a=t(e+8),i=t(e+16),g=this.mem.getInt32(e+24,!0);fs.writeSync(a,new Uint8Array(this._inst.exports.mem.buffer,i,g))},"runtime.resetMemoryDataView":e=>{this.mem=new DataView(this._inst.exports.mem.buffer)},"runtime.nanotime1":e=>{e>>>=0,r(e+8,(_+performance.now())*1e6)},"runtime.walltime":e=>{e>>>=0;const a=new Date().getTime();r(e+8,a/1e3),this.mem.setInt32(e+16,a%1e3*1e6,!0)},"runtime.scheduleTimeoutEvent":e=>{e>>>=0;const a=this._nextCallbackTimeoutID;this._nextCallbackTimeoutID++,this._scheduledTimeouts.set(a,setTimeout(()=>{for(this._resume();this._scheduledTimeouts.has(a);)console.warn("scheduleTimeoutEvent: missed timeout event"),this._resume()},t(e+8))),this.mem.setInt32(e+16,a,!0)},"runtime.clearTimeoutEvent":e=>{e>>>=0;const a=this.mem.getInt32(e+8,!0);clearTimeout(this._scheduledTimeouts.get(a)),this._scheduledTimeouts.delete(a)},"runtime.getRandomData":e=>{e>>>=0,crypto.getRandomValues(p(e+8))},"syscall/js.finalizeRef":e=>{e>>>=0;const a=this.mem.getUint32(e+8,!0);if(this._goRefCounts[a]--,this._goRefCounts[a]===0){const i=this._values[a];this._values[a]=null,this._ids.delete(i),this._idPool.push(a)}},"syscall/js.stringVal":e=>{e>>>=0,s(e+24,f(e+8))},"syscall/js.valueGet":e=>{e>>>=0;const a=Reflect.get(l(e+8),f(e+16));e=this._inst.exports.getsp()>>>0,s(e+32,a)},"syscall/js.valueSet":e=>{e>>>=0,Reflect.set(l(e+8),f(e+16),l(e+32))},"syscall/js.valueDelete":e=>{e>>>=0,Reflect.deleteProperty(l(e+8),f(e+16))},"syscall/js.valueIndex":e=>{e>>>=0,s(e+24,Reflect.get(l(e+8),t(e+16)))},"syscall/js.valueSetIndex":e=>{e>>>=0,Reflect.set(l(e+8),t(e+16),l(e+24))},"syscall/js.valueCall":e=>{e>>>=0;try{const a=l(e+8),i=Reflect.get(a,f(e+16)),g=v(e+32),V=Reflect.apply(i,a,g);e=this._inst.exports.getsp()>>>0,s(e+56,V),this.mem.setUint8(e+64,1)}catch(a){e=this._inst.exports.getsp()>>>0,s(e+56,a),this.mem.setUint8(e+64,0)}},"syscall/js.valueInvoke":e=>{e>>>=0;try{const a=l(e+8),i=v(e+16),g=Reflect.apply(a,void 0,i);e=this._inst.exports.getsp()>>>0,s(e+40,g),this.mem.setUint8(e+48,1)}catch(a){e=this._inst.exports.getsp()>>>0,s(e+40,a),this.mem.setUint8(e+48,0)}},"syscall/js.valueNew":e=>{e>>>=0;try{const a=l(e+8),i=v(e+16),g=Reflect.construct(a,i);e=this._inst.exports.getsp()>>>0,s(e+40,g),this.mem.setUint8(e+48,1)}catch(a){e=this._inst.exports.getsp()>>>0,s(e+40,a),this.mem.setUint8(e+48,0)}},"syscall/js.valueLength":e=>{e>>>=0,r(e+16,parseInt(l(e+8).length))},"syscall/js.valuePrepareString":e=>{e>>>=0;const a=n.encode(String(l(e+8)));s(e+16,a),r(e+24,a.length)},"syscall/js.valueLoadString":e=>{e>>>=0;const a=l(e+8);p(e+16).set(a)},"syscall/js.valueInstanceOf":e=>{e>>>=0,this.mem.setUint8(e+24,l(e+8)instanceof l(e+16)?1:0)},"syscall/js.copyBytesToGo":e=>{e>>>=0;const a=p(e+8),i=l(e+32);if(!(i instanceof Uint8Array||i instanceof Uint8ClampedArray)){this.mem.setUint8(e+48,0);return}const g=i.subarray(0,a.length);a.set(g),r(e+40,g.length),this.mem.setUint8(e+48,1)},"syscall/js.copyBytesToJS":e=>{e>>>=0;const a=l(e+8),i=p(e+16);if(!(a instanceof Uint8Array||a instanceof Uint8ClampedArray)){this.mem.setUint8(e+48,0);return}const g=i.subarray(0,a.length);a.set(g),r(e+40,g.length),this.mem.setUint8(e+48,1)},debug:e=>{console.log(e)}}}}async run(r){if(!(r instanceof WebAssembly.Instance))throw new Error("Go.run: WebAssembly.Instance expected");this._inst=r,this.mem=new DataView(this._inst.exports.mem.buffer),this._values=[NaN,0,null,!0,!1,globalThis,this],this._goRefCounts=new Array(this._values.length).fill(1/0),this._ids=new Map([[0,1],[null,2],[!0,3],[!1,4],[globalThis,5],[this,6]]),this._idPool=[],this.exited=!1;let t=4096;const l=e=>{const a=t,i=n.encode(e+"\0");return new Uint8Array(this.mem.buffer,t,i.length).set(i),t+=i.length,t%8!==0&&(t+=8-t%8),a},s=this.argv.length,p=[];this.argv.forEach(e=>{p.push(l(e))}),p.push(0),Object.keys(this.env).sort().forEach(e=>{p.push(l(`${e}=${this.env[e]}`))}),p.push(0);const f=t;if(p.forEach(e=>{this.mem.setUint32(t,e,!0),this.mem.setUint32(t+4,0,!0),t+=8}),t>=12288)throw new Error("total length of command line and environment variables exceeds limit");this._inst.exports.run(s,f),this.exited&&this._resolveExitPromise(),await this._exitPromise}_resume(){if(this.exited)throw new Error("Go program has already exited");this._inst.exports.resume(),this.exited&&this._resolveExitPromise()}_makeFuncWrapper(r){const t=this;return function(){const l={id:r,this:this,args:arguments};return t._pendingEvent=l,t._resume(),l.result}}}})();async function xe(){if(typeof electronBridge<"u"){const d=await electronBridge.loadWasm();return new Response(d,{headers:{"Content-Type":"application/wasm"}})}else return await fetch("main.wasm")}const de=ne("appStatus",()=>{const d=F(),n=T("editing"),c=T(!1),r=T(""),t=T([]);function l(_){oe.alert(ae("pre",{style:{overflow:"scroll"}},`运行时遇到错误：
`+_),"错误",{type:"error"})}const s=new Go;WebAssembly.instantiateStreaming(xe(),s.importObject).then(_=>{s.run(_.instance),RhythmologistGo.registerErrorMessageCallback(l),c.value=!0});function p(){n.value="editing"}function v(){if(!c.value)return;t.value=[],n.value="running";const _=RhythmologistGo.generateBatchPreset(K.stringify(d.config),r.value);_!==null&&(t.value=K.parse(_),f())}function f(){n.value="result"}return{currentStep:n,goWasmReady:c,selectedPresetName:r,generationResult:t,edit:p,run:v,showResult:f}}),$=Symbol("keyForXObjArray");function ce(d){return d[$]||(d[$]=Symbol()),d[$]}const Ie={style:{"margin-bottom":"8px"}},Ue={style:{"margin-bottom":"8px"}},Pe=U({__name:"ConfigChildItemList",props:M({defaultNewItemValue:{},dialogTitle:{default:""},dialogPrompt:{default:""},dialogErrorText:{default:""},disableScroll:{type:Boolean,default:!0},retrieveKey:{type:Function,default:(d,n)=>n}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(d){const n=G(d,"modelValue"),c=d,r=T(!1),t=T(""),l=P(()=>!(t.value in n.value)&&t.value.length>0);function s(){Array.isArray(n.value)?n.value.push(c.defaultNewItemValue()):(n.value[t.value]=c.defaultNewItemValue(),t.value="",r.value=!1)}function p(){Array.isArray(n.value)?s():r.value=!0}function v(a){Array.isArray(n.value)?n.value.splice(a,1):delete n.value[a]}function f(a){if(Array.isArray(n.value)){const i=c.defaultNewItemValue();typeof n.value[a][$]<"u"&&(i[$]=n.value[a][$]),n.value[a]=i}else n.value[a]=c.defaultNewItemValue()}function _(a){if(Array.isArray(n.value)){let i=n.value.splice(a,1);n.value.splice(a-1,0,...i)}}function e(a){if(Array.isArray(n.value)){let i=n.value.splice(a,1);n.value.splice(a+1,0,...i)}}return(a,i)=>{const g=m("ElIcon"),V=m("ElButton"),z=m("ElForm"),B=m("ElCollapseItem"),L=m("ElCollapse"),x=m("ElScrollbar"),R=m("ElInput"),I=m("ElText"),H=m("el-button"),me=m("ElDialog");return h(),S(C,null,[y("div",{class:ge({"disable-scroll":c.disableScroll}),style:{display:"flex","flex-direction":"column"}},[y("div",Ie,[o(V,{onClick:i[0]||(i[0]=N=>p())},{default:u(()=>[o(g,null,{default:u(()=>[o(b(fe))]),_:1})]),_:1})]),o(x,{style:{"padding-right":"10px"}},{default:u(()=>[o(L,null,{default:u(()=>[(h(!0),S(C,null,A(n.value,(N,O)=>(h(),E(B,{key:a.retrieveKey(N,O)},{title:u(()=>[te(a.$slots,"itemTitle",{item:N,key:O},()=>[w(j(O),1)],!0),Array.isArray(n.value)?(h(),S(C,{key:0},[O!==0?(h(),E(g,{key:0,class:"icon",onClick:q(J=>_(O),["stop"])},{default:u(()=>[o(b(se))]),_:2},1032,["onClick"])):k("",!0),O<n.value.length-1?(h(),E(g,{key:1,class:"icon",onClick:q(J=>e(O),["stop"])},{default:u(()=>[o(b(ue))]),_:2},1032,["onClick"])):k("",!0)],64)):k("",!0),o(g,{class:"icon",onClick:q(J=>f(O),["stop"])},{default:u(()=>[o(b(_e))]),_:2},1032,["onClick"]),o(g,{class:"icon",onClick:q(J=>v(O),["stop"])},{default:u(()=>[o(b(re))]),_:2},1032,["onClick"])]),default:u(()=>[o(z,{"label-position":"top"},{default:u(()=>[te(a.$slots,"default",{item:N,key:O},void 0,!0)]),_:2},1024)]),_:2},1024))),128))]),_:3})]),_:3})],2),o(me,{modelValue:r.value,"onUpdate:modelValue":i[4]||(i[4]=N=>r.value=N),title:c.dialogTitle},{footer:u(()=>[y("span",null,[o(H,{onClick:i[2]||(i[2]=N=>r.value=!1)},{default:u(()=>[w("取消")]),_:1}),o(H,{type:"primary",disabled:!l.value,onClick:i[3]||(i[3]=N=>s())},{default:u(()=>[w(" 添加 ")]),_:1},8,["disabled"])])]),default:u(()=>[y("div",Ue,j(c.dialogPrompt),1),o(R,{modelValue:t.value,"onUpdate:modelValue":i[1]||(i[1]=N=>t.value=N)},null,8,["modelValue"]),Q(o(I,{type:"danger"},{default:u(()=>[w(j(c.dialogErrorText),1)]),_:1},512),[[Z,!l.value]])]),_:1},8,["modelValue","title"])],64)}}}),X=(d,n)=>{const c=d.__vccOpts||d;for(const[r,t]of n)c[r]=t;return c},D=X(Pe,[["__scopeId","data-v-613da4c1"]]),ke=U({__name:"PatternsPane",setup(d){const n=F();return(c,r)=>{const t=m("ElInputNumber"),l=m("ElFormItem"),s=m("ElInput");return h(),E(D,{modelValue:b(n).config.patterns,"onUpdate:modelValue":r[0]||(r[0]=p=>b(n).config.patterns=p),"default-new-item-value":()=>({length:1}),"dialog-title":"添加节奏型","dialog-prompt":"请为节奏型设定一个唯一的标识名称，此名称会在其他地方用于指代此节奏型。","dialog-error-text":"名称不能为空或与现有节奏型重复。"},{default:u(({item:p})=>[o(l,{label:"长度length",required:""},{default:u(()=>[o(t,{modelValue:p.length,"onUpdate:modelValue":v=>p.length=v},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(l,{label:"显示名称displayName"},{default:u(()=>[o(s,{modelValue:p.displayName,"onUpdate:modelValue":v=>p.displayName=v},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(l,{label:"ABC格式显示内容displayAbc (默认L: 1/16)"},{default:u(()=>[o(s,{modelValue:p.displayAbc,"onUpdate:modelValue":v=>p.displayAbc=v},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1},8,["modelValue"])}}}),Re=U({__name:"CategoriesPane",setup(d){const n=F();return(c,r)=>{const t=m("ElOption"),l=m("ElSelect"),s=m("ElFormItem");return h(),E(D,{modelValue:b(n).config.categories,"onUpdate:modelValue":r[0]||(r[0]=p=>b(n).config.categories=p),"default-new-item-value":()=>[],"dialog-title":"添加类别","dialog-prompt":"请为节奏型类别设定一个唯一的标识名称，此名称会在其他地方用于指代此类别。","dialog-error-text":"名称不能为空或与现有类别名重复。"},{default:u(({key:p})=>[o(s,{required:""},{default:u(()=>[o(l,{modelValue:b(n).config.categories[p],"onUpdate:modelValue":v=>b(n).config.categories[p]=v,multiple:"",filterable:""},{default:u(()=>[(h(!0),S(C,null,A(b(n).config.patterns,(v,f)=>(h(),E(t,{key:f,label:f,value:f},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1},8,["modelValue"])}}}),Te=U({__name:"FillEachBlankActionView",props:M({parentRuleSet:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(d){const n=G(d,"modelValue"),c=d,r=P(()=>n.value.fillEachBlank);return(t,l)=>{const s=m("ElOption"),p=m("ElSelect"),v=m("ElFormItem"),f=m("ElInputNumber"),_=m("ElCard");return r.value?(h(),S(C,{key:0},[o(v,{label:"区域范围in",required:""},{default:u(()=>[o(p,{modelValue:r.value.in,"onUpdate:modelValue":l[0]||(l[0]=e=>r.value.in=e),multiple:"",filterable:""},{default:u(()=>[(h(!0),S(C,null,A(c.parentRuleSet.layout,(e,a)=>(h(),E(s,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(v,{label:"步长stepLength"},{default:u(()=>[o(f,{modelValue:r.value.stepLength,"onUpdate:modelValue":l[1]||(l[1]=e=>r.value.stepLength=e)},null,8,["modelValue"])]),_:1}),o(v,{label:"调用动作with",required:""},{default:u(()=>[o(_,{shadow:"never",style:{width:"100%"},class:"card-remove-last-margin-bottom"},{default:u(()=>[o(Y,{modelValue:r.value.with,"onUpdate:modelValue":l[2]||(l[2]=e=>r.value.with=e),mode:"action","parent-rule-set":t.parentRuleSet},null,8,["modelValue","parent-rule-set"])]),_:1})]),_:1})],64)):k("",!0)}}}),Ae=U({__name:"ChooseARandomPositionActionView",props:M({parentRuleSet:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(d){const n=G(d,"modelValue"),c=d,r=P(()=>n.value.chooseARandomPosition);return(t,l)=>{const s=m("ElOption"),p=m("ElSelect"),v=m("ElFormItem"),f=m("ElInputNumber"),_=m("ElCard");return r.value?(h(),S(C,{key:0},[o(v,{label:"区域范围in",required:""},{default:u(()=>[o(p,{modelValue:r.value.in,"onUpdate:modelValue":l[0]||(l[0]=e=>r.value.in=e),multiple:"",filterable:""},{default:u(()=>[(h(!0),S(C,null,A(c.parentRuleSet.layout,(e,a)=>(h(),E(s,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(v,{label:"长度length",required:""},{default:u(()=>[o(f,{modelValue:r.value.length,"onUpdate:modelValue":l[1]||(l[1]=e=>r.value.length=e)},null,8,["modelValue"])]),_:1}),o(v,{label:"调用动作do",required:""},{default:u(()=>[o(_,{shadow:"never",style:{width:"100%"},class:"card-remove-last-margin-bottom"},{default:u(()=>[o(Y,{modelValue:r.value.do,"onUpdate:modelValue":l[2]||(l[2]=e=>r.value.do=e),mode:"action","parent-rule-set":t.parentRuleSet},null,8,["modelValue","parent-rule-set"])]),_:1})]),_:1})],64)):k("",!0)}}}),Ne=U({__name:"RandomPickActionView",props:M({parentRuleSet:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(d){const n=F(),c=G(d,"modelValue"),r=d,t=P(()=>c.value.randomPick);return(l,s)=>{const p=m("ElOption"),v=m("ElSelect"),f=m("ElButton"),_=m("ElFormItem"),e=m("ElInputNumber"),a=m("ElCard");return t.value?(h(),S(C,{key:0},[o(_,{label:"从分类中选取节奏型fromCategories"},{default:u(()=>[t.value.fromCategories?(h(),E(v,{key:0,modelValue:t.value.fromCategories,"onUpdate:modelValue":s[0]||(s[0]=i=>t.value.fromCategories=i),multiple:"",filterable:""},{default:u(()=>[(h(!0),S(C,null,A(b(n).config.categories,(i,g)=>(h(),E(p,{key:g,label:g,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(h(),E(f,{key:1,onClick:s[1]||(s[1]=i=>t.value.fromCategories=[])},{default:u(()=>[w("创建")]),_:1}))]),_:1}),o(_,{label:"从此列表中选取节奏型fromList"},{default:u(()=>[t.value.fromList?(h(),E(v,{key:0,modelValue:t.value.fromList,"onUpdate:modelValue":s[2]||(s[2]=i=>t.value.fromList=i),multiple:"",filterable:""},{default:u(()=>[(h(!0),S(C,null,A(b(n).config.patterns,(i,g)=>(h(),E(p,{key:g,label:g,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(h(),E(f,{key:1,onClick:s[3]||(s[3]=i=>t.value.fromList=[])},{default:u(()=>[w("创建")]),_:1}))]),_:1}),o(_,{label:"长度length"},{default:u(()=>[o(e,{modelValue:t.value.length,"onUpdate:modelValue":s[4]||(s[4]=i=>t.value.length=i)},null,8,["modelValue"])]),_:1}),o(_,{label:"在此布局区域开头放置in"},{default:u(()=>[o(v,{modelValue:t.value.in,"onUpdate:modelValue":s[5]||(s[5]=i=>t.value.in=i),filterable:""},{default:u(()=>[(h(!0),S(C,null,A(r.parentRuleSet.layout,(i,g)=>(h(),E(p,{key:g,label:g,value:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(_,{label:"在指定节拍位置放置(0起计数)at"},{default:u(()=>[o(e,{modelValue:t.value.at,"onUpdate:modelValue":s[6]||(s[6]=i=>t.value.at=i)},null,8,["modelValue"])]),_:1}),o(_,{label:"约束constraints"},{default:u(()=>[t.value.constraints?(h(),E(a,{key:0,shadow:"never",style:{width:"100%"}},{default:u(()=>[o(D,{modelValue:t.value.constraints,"onUpdate:modelValue":s[7]||(s[7]=i=>t.value.constraints=i),"default-new-item-value":()=>({}),"disable-scroll":!1,"retrieve-key":b(ce)},{itemTitle:u(({item:i,key:g})=>[w(j(g)+" : "+j(Object.keys(i)[0]),1)]),default:u(({key:i})=>[o(Y,{modelValue:t.value.constraints[i],"onUpdate:modelValue":g=>t.value.constraints[i]=g,mode:"constraint","parent-rule-set":r.parentRuleSet},null,8,["modelValue","onUpdate:modelValue","parent-rule-set"])]),_:1},8,["modelValue","retrieve-key"])]),_:1})):(h(),E(f,{key:1,onClick:s[8]||(s[8]=i=>t.value.constraints=[])},{default:u(()=>[w("创建")]),_:1}))]),_:1})],64)):k("",!0)}}}),Oe=U({__name:"UsageCountGroupConstraintView",props:M({parentRuleSet:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(d){const n=G(d,"modelValue"),c=P(()=>n.value.usageCountGroup);return(r,t)=>{const l=m("ElInput"),s=m("ElFormItem");return c.value?(h(),E(s,{key:0,label:"名称name",required:""},{default:u(()=>[o(l,{modelValue:c.value.name,"onUpdate:modelValue":t[0]||(t[0]=p=>c.value.name=p)},null,8,["modelValue"])]),_:1})):k("",!0)}}}),$e={style:{"margin-top":"4px",display:"flex","align-items":"center"}},Fe=U({__name:"RejectPatternWithUsageCountConstraintView",props:M({parentRuleSet:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(d){const n=G(d,"modelValue"),c=P(()=>n.value.rejectPatternWithUsageCount),r=P(()=>{var t,l,s;return((t=c.value)==null?void 0:t.value)==="max"||((l=c.value)==null?void 0:l.value)==="maxAutoBalance"||typeof((s=c.value)==null?void 0:s.value)=="number"});return(t,l)=>{const s=m("ElRadio"),p=m("ElRadioGroup"),v=m("ElFormItem"),f=m("ElInput"),_=m("ElOption"),e=m("ElSelect"),a=m("ElText"),i=m("ElButton");return c.value?(h(),S(C,{key:0},[o(v,{label:"层级level",required:""},{default:u(()=>[o(p,{modelValue:c.value.level,"onUpdate:modelValue":l[0]||(l[0]=g=>c.value.level=g)},{default:u(()=>[o(s,{label:"batch"},{default:u(()=>[w("批次batch")]),_:1}),o(s,{label:"piece"},{default:u(()=>[w("条目piece")]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(v,{label:"计数组名称groupName",required:""},{default:u(()=>[o(f,{modelValue:c.value.groupName,"onUpdate:modelValue":l[1]||(l[1]=g=>c.value.groupName=g)},null,8,["modelValue"])]),_:1}),o(v,{label:"比较运算符comparator",required:""},{default:u(()=>[o(e,{modelValue:c.value.comparator,"onUpdate:modelValue":l[2]||(l[2]=g=>c.value.comparator=g)},{default:u(()=>[(h(),S(C,null,A(["<","<=","==",">=",">","!="],g=>o(_,{key:g,label:g,value:g},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),o(v,{label:"比较值value",required:""},{default:u(()=>[o(f,{modelValue:c.value.value,"onUpdate:modelValue":l[3]||(l[3]=g=>c.value.value=g),modelModifiers:{number:!0}},null,8,["modelValue"]),y("div",$e,[o(a,{size:"small"},{default:u(()=>[w("特殊值：")]),_:1}),o(i,{size:"small",onClick:l[4]||(l[4]=g=>c.value.value="max")},{default:u(()=>[w("max")]),_:1}),o(i,{size:"small",onClick:l[5]||(l[5]=g=>c.value.value="maxAutoBalance")},{default:u(()=>[w("maxAutoBalance")]),_:1})]),Q(o(a,{type:"danger"},{default:u(()=>[w("value值无效，应为数字或“max”，“maxAutoBalance”")]),_:1},512),[[Z,!r.value]])]),_:1})],64)):k("",!0)}}}),Y=U({__name:"XObjEditor",props:M({mode:{},parentRuleSet:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(d){const n=G(d,"modelValue"),c=d,r=P(()=>{if(c.mode==="action")return{fillEachBlank:{defaults:()=>({in:[],with:{}}),view:Te},chooseARandomPosition:{defaults:()=>({in:[],length:1,do:{}}),view:Ae},randomPick:{defaults:()=>({}),view:Ne}};if(c.mode==="constraint")return{usageCountGroup:{defaults:()=>({name:""}),view:Oe},rejectPatternWithUsageCount:{defaults:()=>({level:"piece",groupName:"",comparator:">=",value:"maxAutoBalance"}),view:Fe}};throw TypeError()});function t(s){return s in r.value}const l=P({get:()=>{const s=Object.keys(n.value);if(s.length===0)return"";if(t(s[0]))return s[0];throw TypeError()},set:s=>{if(s==="")n.value={[$]:n.value[$]};else if(t(s))n.value={[s]:r.value[s].defaults(),[$]:n.value[$]};else return}});return(s,p)=>{var e;const v=m("ElOption"),f=m("ElSelect"),_=m("ElFormItem");return h(),S(C,null,[o(_,{label:"动作类型",required:""},{default:u(()=>[o(f,{modelValue:l.value,"onUpdate:modelValue":p[0]||(p[0]=a=>l.value=a),filterable:""},{default:u(()=>[(h(!0),S(C,null,A(r.value,(a,i)=>(h(),E(v,{key:i,value:i},null,8,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),(h(),E(ie(l.value===""?null:(e=r.value[l.value])==null?void 0:e.view),{modelValue:n.value,"onUpdate:modelValue":p[1]||(p[1]=a=>n.value=a),"parent-rule-set":s.parentRuleSet},null,8,["modelValue","parent-rule-set"]))],64)}}}),je=U({__name:"RuleSetsPane",setup(d){const n=F();return(c,r)=>{const t=m("ElInput"),l=m("ElFormItem"),s=m("ElInputNumber"),p=m("ElCard");return h(),E(D,{modelValue:b(n).config.ruleSets,"onUpdate:modelValue":r[0]||(r[0]=v=>b(n).config.ruleSets=v),"default-new-item-value":()=>({timeSignature:"4/4",bpm:72,pieceLength:8,layout:{},actions:[]}),"dialog-title":"添加规则集","dialog-prompt":"请为规则集设定一个唯一的标识名称，此名称会在其他地方用于指代此规则集。","dialog-error-text":"名称不能为空或与现有规则集重复。"},{default:u(({item:v,key:f})=>[o(l,{label:"拍号timeSignature",required:""},{default:u(()=>[o(t,{modelValue:v.timeSignature,"onUpdate:modelValue":_=>v.timeSignature=_},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(l,{label:"速度bpm",required:""},{default:u(()=>[o(s,{modelValue:v.bpm,"onUpdate:modelValue":_=>v.bpm=_},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(l,{label:"每条长度pieceLength",required:""},{default:u(()=>[o(s,{modelValue:v.pieceLength,"onUpdate:modelValue":_=>v.pieceLength=_},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(l,{label:"布局layout",required:""},{default:u(()=>[o(p,{shadow:"never",style:{width:"100%"}},{default:u(()=>[o(D,{modelValue:b(n).config.ruleSets[f].layout,"onUpdate:modelValue":_=>b(n).config.ruleSets[f].layout=_,"default-new-item-value":()=>({start:0,end:v.pieceLength}),"dialog-title":"添加布局区域","dialog-prompt":"请为布局区域设定一个唯一的标识名称，此名称会在其他地方用于指代此布局区域。","dialog-error-text":"名称不能为空或与现有布局区域重复。","disable-scroll":!1},{default:u(({item:_})=>[o(l,{label:"起点(含)start",required:""},{default:u(()=>[o(s,{modelValue:_.start,"onUpdate:modelValue":e=>_.start=e},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(l,{label:"终点(不含)end",required:""},{default:u(()=>[o(s,{modelValue:_.end,"onUpdate:modelValue":e=>_.end=e},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue","default-new-item-value"])]),_:2},1024)]),_:2},1024),o(l,{label:"动作actions",required:""},{default:u(()=>[o(p,{shadow:"never",style:{width:"100%"}},{default:u(()=>[o(D,{modelValue:b(n).config.ruleSets[f].actions,"onUpdate:modelValue":_=>b(n).config.ruleSets[f].actions=_,"default-new-item-value":()=>({}),"disable-scroll":!1,"retrieve-key":b(ce)},{itemTitle:u(({item:_,key:e})=>[w(j(e)+" : "+j(Object.keys(_)[0]),1)]),default:u(({key:_})=>[o(Y,{modelValue:b(n).config.ruleSets[f].actions[_],"onUpdate:modelValue":e=>b(n).config.ruleSets[f].actions[_]=e,mode:"action","parent-rule-set":b(n).config.ruleSets[f]},null,8,["modelValue","onUpdate:modelValue","parent-rule-set"])]),_:2},1032,["modelValue","onUpdate:modelValue","retrieve-key"])]),_:2},1024)]),_:2},1024)]),_:1},8,["modelValue"])}}}),Be={style:{display:"flex","justify-content":"flex-end"}},Le=U({__name:"BatchPresetsPane",setup(d){const n=F(),c=P(()=>{if(!n.config.batchPresets)return{};let f={};for(const _ in n.config.batchPresets)if(Object.prototype.hasOwnProperty.call(n.config.batchPresets,_)){const e=n.config.batchPresets[_];f[_]=e.map(a=>{let i=Object.keys(a);return i.length<=0?{ruleSetName:"",amount:0}:{ruleSetName:i[0],amount:a[i[0]]}})}return f}),r=T(""),t=T(1);function l(f){n.config.batchPresets&&n.config.batchPresets[f].push({[r.value]:t.value})}function s(f,_){n.config.batchPresets&&n.config.batchPresets[f].splice(_,1)}function p(f,_){if(n.config.batchPresets){let e=n.config.batchPresets[f].splice(_,1);n.config.batchPresets[f].splice(_-1,0,...e)}}function v(f,_){if(n.config.batchPresets){let e=n.config.batchPresets[f].splice(_,1);n.config.batchPresets[f].splice(_+1,0,...e)}}return(f,_)=>{const e=m("ElOption"),a=m("ElSelect"),i=m("ElFormItem"),g=m("ElInputNumber"),V=m("ElButton"),z=m("ElForm"),B=m("ElTableColumn"),L=m("ElIcon"),x=m("ElTable");return b(n).config.batchPresets?(h(),E(D,{key:0,modelValue:b(n).config.batchPresets,"onUpdate:modelValue":_[2]||(_[2]=R=>b(n).config.batchPresets=R),"default-new-item-value":()=>[],"dialog-title":"添加批量生成预设","dialog-prompt":"请为批量生成预设设定一个唯一的标识名称，此名称会在其他地方用于指代此预设。","dialog-error-text":"名称不能为空或与现有批量生成预设重复。"},{default:u(({key:R})=>[o(z,{inline:"",style:{display:"flex"}},{default:u(()=>[o(i,{style:{width:"calc((100% - 110px) * 0.5)"}},{default:u(()=>[o(a,{modelValue:r.value,"onUpdate:modelValue":_[0]||(_[0]=I=>r.value=I),placeholder:"规则集名称ruleSetName",filterable:""},{default:u(()=>[(h(!0),S(C,null,A(Object.keys(b(n).config.ruleSets),I=>(h(),E(e,{key:I,label:I,value:I},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,null,{default:u(()=>[o(g,{modelValue:t.value,"onUpdate:modelValue":_[1]||(_[1]=I=>t.value=I),placeholder:"数量amount"},null,8,["modelValue"])]),_:1}),o(i,null,{default:u(()=>[o(V,{onClick:I=>l(R)},{default:u(()=>[w("添加")]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),o(x,{data:c.value[R]},{default:u(()=>[o(B,{prop:"ruleSetName",label:"规则集名称ruleSetName"}),o(B,{prop:"amount",label:"数量amount"}),o(B,{label:"操作",width:"110px"},{default:u(I=>[y("div",Be,[I.$index!==0?(h(),E(V,{key:0,link:"",class:"icon",onClick:q(H=>p(R,I.$index),["stop"])},{default:u(()=>[o(L,null,{default:u(()=>[o(b(se))]),_:1})]),_:2},1032,["onClick"])):k("",!0),I.$index<c.value[R].length-1?(h(),E(V,{key:1,link:"",class:"icon",onClick:q(H=>v(R,I.$index),["stop"])},{default:u(()=>[o(L,null,{default:u(()=>[o(b(ue))]),_:1})]),_:2},1032,["onClick"])):k("",!0),o(V,{link:"",onClick:q(H=>s(R,I.$index),["prevent"])},{default:u(()=>[o(L,null,{default:u(()=>[o(b(re))]),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1032,["data"])]),_:1},8,["modelValue"])):(h(),E(V,{key:1,onClick:_[3]||(_[3]=R=>b(n).config.batchPresets={})},{default:u(()=>[w(" 创建 ")]),_:1}))}}}),qe=X(Le,[["__scopeId","data-v-e59c59c1"]]),De=U({__name:"SettingsPane",setup(d){const n=F();return n.config.settings||(n.config.settings={autoSeed:!0}),ve(()=>{var c;return(c=n.config.settings)==null?void 0:c.autoSeed},c=>{c&&delete n.config.settings.fixedSeed}),(c,r)=>{const t=m("ElSwitch"),l=m("ElFormItem"),s=m("ElInput"),p=m("ElForm");return h(),E(p,{"label-position":"top"},{default:u(()=>[o(l,{label:"自动设置随机数种子autoSeed"},{default:u(()=>[o(t,{modelValue:b(n).config.settings.autoSeed,"onUpdate:modelValue":r[0]||(r[0]=v=>b(n).config.settings.autoSeed=v)},null,8,["modelValue"])]),_:1}),Q(o(l,{label:"固定种子数值fixedSeed"},{default:u(()=>[o(s,{modelValue:b(n).config.settings.fixedSeed,"onUpdate:modelValue":r[1]||(r[1]=v=>b(n).config.settings.fixedSeed=v),modelModifiers:{number:!0}},null,8,["modelValue"])]),_:1},512),[[Z,!b(n).config.settings.autoSeed]])]),_:1})}}}),le=U({__name:"EditorPage",setup(d){const n=F();return(c,r)=>{const t=m("ElTabPane"),l=m("ElTabs"),s=m("ElCol"),p=m("ElScrollbar"),v=m("ElRow");return h(),E(v,{class:"disable-scroll"},{default:u(()=>[o(s,{span:16,class:"disable-scroll"},{default:u(()=>[o(l,{"tab-position":"left",class:"disable-scroll"},{default:u(()=>[o(t,{label:"节奏型列表patterns",class:"disable-scroll"},{default:u(()=>[o(ke)]),_:1}),o(t,{label:"节奏型分类categories",class:"disable-scroll"},{default:u(()=>[o(Re)]),_:1}),o(t,{label:"规则集ruleSets",class:"disable-scroll"},{default:u(()=>[o(je)]),_:1}),o(t,{label:"批量生成预设batchPresets",class:"disable-scroll"},{default:u(()=>[o(qe)]),_:1}),o(t,{label:"生成器设置settings",class:"disable-scroll"},{default:u(()=>[o(De)]),_:1})]),_:1})]),_:1}),o(s,{span:8,class:"disable-scroll"},{default:u(()=>[o(p,null,{default:u(()=>[y("code",null,[y("pre",null,j(b(K).stringify(b(n).config)),1)])]),_:1})]),_:1})]),_:1})}}});function Me(d){return d.map((n,c)=>`
X: ${c}
V: T1 name=${c+1} stem=up
K:  perc stafflines=1 middle=A
M: ${n.timeSignature}
L: 1/16
Q: ${n.bpm}
${n.beats.map((r,t)=>(t%Ge(n.timeSignature).upper==0&&t>0?" | ":"")+(r.offset===0?r.pattern.displayAbc:"")).join(" ")}|]
`).join("")}function Ge(d){const n=d.split("/");return{upper:Number.parseInt(n[0]),lower:Number.parseInt(n[1])}}const We=U({__name:"AbcNotationRenderer",setup(d){const n=de(),c=T(null);function r(){if(c.value){const t=n.generationResult.map(()=>document.createElement("div"));Ee.renderAbc(t,Me(n.generationResult)),c.value.replaceChildren(...t)}}return he(()=>{be(()=>{r()})}),(t,l)=>(h(),S("div",{ref_key:"abcContainer",ref:c},null,512))}}),ze=U({__name:"ResultPage",setup(d){return(n,c)=>{const r=m("ElScrollbar");return h(),E(r,null,{default:u(()=>[o(We)]),_:1})}}}),He=X(ze,[["__scopeId","data-v-5e14a08d"]]),W=d=>(Ve("data-v-ded536bd"),d=d(),ye(),d),Ke={style:{"margin-left":"50px","margin-right":"50px",flex:"1"}},Xe={style:{"margin-left":"auto"}},Ye=W(()=>y("h1",null,"Rhythmologist",-1)),Je=W(()=>y("p",null,"Copyright © 2024 Liu Chibing. All rights reserved.",-1)),Qe=W(()=>y("h2",null,"鸣谢",-1)),Ze=W(()=>y("p",null,"王晔 教授",-1)),et=W(()=>y("h3",null,"开源代码",-1)),tt=W(()=>y("ul",null,[y("li",null,"Vue"),y("li",null,"Element Plus"),y("li",null,"TypeScript"),y("li",null,"Go"),y("li",null,"Electron")],-1)),lt=U({__name:"App",setup(d){const n=de(),c=F(),r=P(()=>{switch(n.currentStep){case"editing":return 1;case"running":case"result":return 2;default:return 0}}),t=P(()=>{switch(n.currentStep){case"editing":return"process";case"running":case"result":return"success";default:return"wait"}}),l=P(()=>{switch(n.currentStep){case"editing":return"wait";case"running":return"process";case"result":return"success";default:return"wait"}}),s=P(()=>{switch(n.currentStep){case"editing":return le;case"running":case"result":return He;default:return le}}),p=T(!1);return(v,f)=>{const _=m("ElStep"),e=m("ElSteps"),a=m("ElOption"),i=m("ElSelect"),g=m("ElButton"),V=m("ElHeader"),z=m("ElMain"),B=m("ElContainer"),L=m("ElDialog");return h(),S(C,null,[o(B,{class:"disable-scroll"},{default:u(()=>[o(V,null,{default:u(()=>[y("h1",{onClick:f[0]||(f[0]=x=>p.value=!0)},"Rhythmologist"),y("div",Ke,[o(e,{simple:"",active:r.value},{default:u(()=>[o(_,{title:"配置编辑",status:t.value},null,8,["status"]),o(_,{title:"运行结果",status:l.value},null,8,["status"])]),_:1},8,["active"])]),y("div",Xe,[b(c).config.batchPresets?(h(),E(i,{key:0,modelValue:b(n).selectedPresetName,"onUpdate:modelValue":f[1]||(f[1]=x=>b(n).selectedPresetName=x),placeholder:"选择生成预设",style:{width:"150px","margin-right":"12px"}},{default:u(()=>[(h(!0),S(C,null,A(Object.keys(b(c).config.batchPresets),x=>(h(),E(a,{key:x,label:x,value:x},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):k("",!0),o(g,{disabled:!b(c).config.batchPresets||!(b(n).selectedPresetName in b(c).config.batchPresets)||!b(n).goWasmReady,onClick:f[2]||(f[2]=x=>b(n).run())},{default:u(()=>[w(" 运行 ")]),_:1},8,["disabled"]),k("",!0),b(n).currentStep==="editing"?(h(),S(C,{key:2},[o(g,{onClick:f[3]||(f[3]=x=>b(c).load())},{default:u(()=>[w("打开")]),_:1}),o(g,{onClick:f[4]||(f[4]=x=>b(c).save())},{default:u(()=>[w("保存")]),_:1})],64)):(h(),E(g,{key:3,onClick:f[5]||(f[5]=x=>b(n).edit())},{default:u(()=>[w("返回编辑")]),_:1}))])]),_:1}),o(z,{class:"disable-scroll"},{default:u(()=>[(h(),E(ie(s.value)))]),_:1})]),_:1}),o(L,{modelValue:p.value,"onUpdate:modelValue":f[6]||(f[6]=x=>p.value=x),title:"关于",class:"about-dialog"},{default:u(()=>[Ye,Je,Qe,Ze,et,tt]),_:1},8,["modelValue"])],64)}}}),nt=X(lt,[["__scopeId","data-v-ded536bd"]]),ee=we(nt);ee.use(Se());ee.use(Ce);ee.mount("#app");
